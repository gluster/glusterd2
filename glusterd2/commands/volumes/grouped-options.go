package volumecommands

import (
	"github.com/gluster/glusterd2/pkg/api"
)

// defaultGroupOptions maps from a profile name to a set of options
var defaultGroupOptions = map[string]*api.OptionGroup{
	"profile.default.replicate": {
		Name: "profile.default.replicate",
		Options: []api.VolumeOption{
			{Name: "cluster/replicate.self-heal-daemon", OnValue: "off"},
			{Name: "performance/quick-read", OnValue: "off"},
			{Name: "performance/io-cache", OnValue: "on"},
			{Name: "performance/readdir-ahead", OnValue: "off"},
			{Name: "performance/read-ahead", OnValue: "off"},
			{Name: "performance/write-behind", OnValue: "on"},
			{Name: "performance/open-behind", OnValue: "on"},
			{Name: "performance/md-cache", OnValue: "on"},
			{Name: "performance/nl-cache", OnValue: "on"},
		},
		Description: "Default volume options for Replicate or Distributed Replicate volumes",
	},
	"profile.default.disperse": {
		Name: "profile.default.disperse",
		Options: []api.VolumeOption{
			{Name: "cluster/replicate.self-heal-daemon", OnValue: "on"},
			{Name: "performance/md-cache", OnValue: "off"},
			{Name: "performance/open-behind", OnValue: "off"},
			{Name: "performance/quick-read", OnValue: "off"},
			{Name: "performance/io-cache", OnValue: "off"},
			{Name: "performance/readdir-ahead", OnValue: "off"},
			{Name: "performance/read-ahead", OnValue: "off"},
			{Name: "performance/write-behind", OnValue: "off"},
		},
		Description: "Default volume options for Disperse or Distributed Disperse volumes",
	},
	"profile.default.distribute": {
		Name: "profile.default.distribute",
		Options: []api.VolumeOption{
			{Name: "performance/quick-read", OnValue: "off"},
			{Name: "performance/io-cache", OnValue: "on"},
			{Name: "performance/readdir-ahead", OnValue: "off"},
			{Name: "performance/read-ahead", OnValue: "off"},
			{Name: "performance/write-behind", OnValue: "on"},
			{Name: "performance/open-behind", OnValue: "on"},
			{Name: "performance/md-cache", OnValue: "on"},
			{Name: "performance/nl-cache", OnValue: "on"},
		},
		Description: "Default volume options for Distribute volumes",
	},
	"profile.gluster-block": {
		Name: "profile.gluster-block",
		Options: []api.VolumeOption{
			{Name: "performance/quick-read", OnValue: "off"},
			{Name: "performance/read-ahead", OnValue: "off"},
			{Name: "performance/io-cache", OnValue: "off"},
			{Name: "performance/md-cache", OnValue: "off"},
			{Name: "performance/open-behind", OnValue: "off"},
			{Name: "performance/readdir-ahead", OnValue: "off"},
			{Name: "performance/write-behind.strict-O_DIRECT", OnValue: "on"},
			{Name: "protocol/client.filter-O_DIRECT", OnValue: "disable"},
			{Name: "cluster/replicate.eager-lock", OnValue: "enable"},
			{Name: "cluster/replicate.quorum-type", OnValue: "auto"},
			{Name: "cluster/replicate.data-self-heal-algorithm", OnValue: "full"},
			{Name: "cluster/replicate.locking-scheme", OnValue: "granular"},
			{Name: "cluster/replicate.shd-max-threads", OnValue: "8"},
			{Name: "cluster/replicate.shd-wait-qlength", OnValue: "10000"},
			{Name: "features/shard", OnValue: "off"},
			{Name: "features/shard.shard-block-size", OnValue: "64MB"},
			{Name: "user.cifs", OnValue: "off"},
			{Name: "protocol/server.rpc-auth-allow-insecure", OnValue: "on"},
		},
		Description: "Enable this profile for optimal results, in block use case",
	},
	"profile.SMB-small-file": {
		Name: "profile.SMB-small-file",
		Options: []api.VolumeOption{
			{Name: "features/upcall.cache-invalidation", OnValue: "on"},
			{Name: "features/upcall.cache-invalidation-timeout", OnValue: "600"},
			{Name: "protocol/server.inode-lru-limit", OnValue: "200000"},
			{Name: "performance/md-cache", OnValue: "on"},
			{Name: "performance/quick-read.cache-invalidation", OnValue: "on"},
			{Name: "performance/md-cache.cache-invalidation", OnValue: "on"},
			{Name: "performance/md-cache.md-cache-timeout", OnValue: "600"},
			{Name: "performance/md-cache.cache-samba-metadata", OnValue: "on"},
			{Name: "performance/nl-cache", OnValue: "on"},
			{Name: "performance/nl-cache.nl-cache-timeout", OnValue: "600"},
			{Name: "performance/quick-read.qr-cache-timeout", OnValue: "600"},
			{Name: "performance/readdir-ahead", OnValue: "on"},
			{Name: "performance/readdir-ahead.parallel-readdir", OnValue: "on"},
			{Name: "protocol/client.event-threads", OnValue: "4"},
			{Name: "protocol/server.event-threads", OnValue: "4"},
			{Name: "cluster/distribute.lookup-optimize", OnValue: "on"},
			{Name: "cluster/distribute.readdir-optimize", OnValue: "on"},
		},
		Description: "For use cases with dominant small file workload in SMB access, enable this profile",
	},
	"profile.FUSE-small-file": {
		Name: "profile.FUSE-small-file",
		Options: []api.VolumeOption{
			{Name: "features/upcall.cache-invalidation", OnValue: "on"},
			{Name: "features/upcall.cache-invalidation-timeout", OnValue: "600"},
			{Name: "protocol/server.inode-lru-limit", OnValue: "200000"},
			{Name: "performance/md-cache", OnValue: "on"},
			{Name: "performance/quick-read.cache-invalidation", OnValue: "on"},
			{Name: "performance/md-cache.cache-invalidation", OnValue: "on"},
			{Name: "performance/md-cache.md-cache-timeout", OnValue: "600"},
			{Name: "performance/nl-cache", OnValue: "on"},
			{Name: "performance/nl-cache.nl-cache-timeout", OnValue: "600"},
			{Name: "performance/quick-read.qr-cache-timeout", OnValue: "600"},
			{Name: "performance/readdir-ahead", OnValue: "on"},
			{Name: "performance/readdir-ahead.parallel-readdir", OnValue: "on"},
			{Name: "protocol/client.event-threads", OnValue: "4"},
			{Name: "protocol/server.event-threads", OnValue: "4"},
			{Name: "cluster/distribute.lookup-optimize", OnValue: "on"},
			{Name: "cluster/distribute.readdir-optimize", OnValue: "on"},
		},
		Description: "For use cases with dominant small file workload in native FUSE mount access, enable this profile",
	},
	"profile.SMB-large-file-EC": {
		Name: "profile.SMB-large-file-EC",
		Options: []api.VolumeOption{
			{Name: "features/upcall.cache-invalidation", OnValue: "on"},
			{Name: "features/upcall.cache-invalidation-timeout", OnValue: "600"},
			{Name: "protocol/server.inode-lru-limit", OnValue: "200000"},
			{Name: "performance/md-cache", OnValue: "on"},
			{Name: "performance/quick-read.cache-invalidation", OnValue: "on"},
			{Name: "performance/md-cache.cache-invalidation", OnValue: "on"},
			{Name: "performance/md-cache.md-cache-timeout", OnValue: "600"},
			{Name: "performance/md-cache.cache-samba-metadata", OnValue: "on"},
			{Name: "performance/nl-cache", OnValue: "on"},
			{Name: "performance/nl-cache.nl-cache-timeout", OnValue: "600"},
			{Name: "performance/readdir-ahead", OnValue: "on"},
			{Name: "performance/readdir-ahead.parallel-readdir", OnValue: "on"},
			{Name: "performance/quick-read", OnValue: "off"},
			{Name: "performance/open-behind", OnValue: "off"},
			{Name: "performance/write-behind.trickling-writes", OnValue: "off"},
			{Name: "performance/write-behind.aggregate-size", OnValue: "1MB"},
			{Name: "protocol/client.event-threads", OnValue: "4"},
			{Name: "protocol/server.event-threads", OnValue: "4"},
		},
		Description: "Enable this profile for use cases consisting of mostly large files like video surveillance, backup, video streaming and others, with SMB access to an erasure coded volume",
	},
	"profile.FUSE-large-file-EC": {
		Name: "profile.FUSE-large-file-EC",
		Options: []api.VolumeOption{
			{Name: "features/upcall.cache-invalidation", OnValue: "on"},
			{Name: "features/upcall.cache-invalidation-timeout", OnValue: "600"},
			{Name: "protocol/server.inode-lru-limit", OnValue: "200000"},
			{Name: "performance.md-cache", OnValue: "on"},
			{Name: "performance/quick-read.cache-invalidation", OnValue: "on"},
			{Name: "performance/md-cache.cache-invalidation", OnValue: "on"},
			{Name: "performance/md-cache.md-cache-timeout", OnValue: "600"},
			{Name: "performance/nl-cache", OnValue: "on"},
			{Name: "performance/nl-cache.nl-cache-timeout", OnValue: "600"},
			{Name: "performance/readdir-ahead", OnValue: "on"},
			{Name: "performance/readdir-ahead.parallel-readdir", OnValue: "on"},
			{Name: "performance/quick-read", OnValue: "off"},
			{Name: "performance/open-behind", OnValue: "off"},
			{Name: "performance/write-behind.trickling-writes", OnValue: "off"},
			{Name: "performance/write-behind.aggregate-size", OnValue: "1MB"},
			{Name: "protocol/client.event-threads", OnValue: "4"},
			{Name: "protocol/server.event-threads", OnValue: "4"},
		},
		Description: "Enable this profile for use cases consisting of mostly large files like video surveillance, backup, video streaming and others, with native FUSE mount access to an erasure coded volume",
	},
	"profile.nl-cache": {
		Name: "profile.nl-cache",
		Options: []api.VolumeOption{
			{Name: "features/upcall.cache-invalidation", OnValue: "on"},
			{Name: "features/upcall.cache-invalidation-timeout", OnValue: "600"},
			{Name: "performance/nl-cache", OnValue: "on"},
			{Name: "performance/nl-cache.nl-cache-timeout", OnValue: "600"},
			{Name: "protocol/server.inode-lru-limit", OnValue: "200000"},
		},
		Description: "Enable this for the workloads that generate lots of lookups before creating files, eg: SMB access, git tool and others",
	},
	"profile.metadata-cache": {
		Name: "profile.metadata-cache",
		Options: []api.VolumeOption{
			{Name: "features/upcall.cache-invalidation", OnValue: "on"},
			{Name: "features/upcall.cache-invalidation-timeout", OnValue: "600"},
			{Name: "performance/md-cache", OnValue: "on"},
			{Name: "performance/quick-read.cache-invalidation", OnValue: "on"},
			{Name: "performance/md-cache.cache-invalidation", OnValue: "on"},
			{Name: "performance/md-cache.md-cache-timeout", OnValue: "600"},
			{Name: "protocol/server.inode-lru-limit", OnValue: "200000"},
		},
		Description: "This profile enables metadata(stat, xattr) caching on client side. Its recommended to enable this for most workloads other than the ones that require 100% consistency like databases",
	},
	"profile.virt": {
		Name: "profile.virt",
		Options: []api.VolumeOption{
			{Name: "performance/quick-read", OnValue: "off"},
			{Name: "performance/read-ahead", OnValue: "off"},
			{Name: "performance/io-cache", OnValue: "off"},
			{Name: "performance/io-threads.low-prio-threads", OnValue: "32"},
			{Name: "protocol/client.filter-O_DIRECT", OnValue: "enable"},
			{Name: "cluster/replicate.eager-lock", OnValue: "enable"},
			{Name: "cluster/replicate.quorum-type", OnValue: "auto"},
			{Name: "cluster.server-quorum-type", OnValue: "server"},
			{Name: "cluster/replicate.data-self-heal-algorithm", OnValue: "full"},
			{Name: "cluster/replicate.locking-scheme", OnValue: "granular"},
			{Name: "cluster/replicate.shd-max-threads", OnValue: "8"},
			{Name: "cluster/replicate.shd-wait-qlength", OnValue: "10000"},
			{Name: "features/shard", OnValue: "on"},
			{Name: "user.cifs", OnValue: "off"},
		},
		Description: "Enable this profile, if the Gluster Volume is used to store virtual machines",
	},
	"profile.db": {
		Name: "profile.db",
		Options: []api.VolumeOption{
			{Name: "performance/open-behind", OnValue: "on"},
			{Name: "performance/write-behind", OnValue: "off"},
			{Name: "performance/quick-read", OnValue: "off"},
			{Name: "performance/read-ahead", OnValue: "off"},
			{Name: "performance/io-cache", OnValue: "off"},
			{Name: "performance/readdir-ahead", OnValue: "off"},
			// as per new volgen, this has been named 'md-cache' instead of its
			// legacy name 'stat-prefetch'
			{Name: "performance/md-cache", OnValue: "off"},
			// https://github.com/gluster/glusterd2/issues/376#issuecomment-424970778
			{Name: "protocol/client.io-threads", OnValue: "on"},
			// xlator options
			{Name: "protocol/server.event-threads", OnValue: "4"},
			{Name: "protocol/client.event-threads", OnValue: "4"},
			{Name: "performance/open-behind.read-after-open", OnValue: "on"},
			{Name: "performance/write-behind.strict-O_DIRECT", OnValue: "on"},
		},
		Description: "Enable profile that tunes volume for database workload",
	},
	"tls": {
		Name: "tls",
		Options: []api.VolumeOption{
			{Name: "protocol/server.transport.socket.ssl-enabled", OnValue: "on"},
			{Name: "protocol/client.transport.socket.ssl-enabled", OnValue: "on"},
		},
		Description: "Enable TLS for the volume for both bricks and clients",
	},
	"profile.test": {
		Name: "profile.test",
		Options: []api.VolumeOption{
			{Name: "cluster/replicate.eager-lock", OnValue: "on"},
			{Name: "gfproxy.cluster/replicate.eager-lock", OnValue: "on"},
		},
		Description: "Test purpose only",
	},
}
